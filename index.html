<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§´‡•â‡§∞‡•ç‡§Æ</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Martel&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Martel', serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        h1 {
            color: #8B4513;
            margin-bottom: 10px;
        }
        
        .download-btn {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px 0;
            transition: background 0.3s;
        }
        
        .download-btn:hover {
            background: #1976D2;
        }
        
        .clear-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            margin: 20px 0 20px 10px;
            transition: background 0.3s;
        }
        
        .clear-btn:hover {
            background: #d32f2f;
        }
        
        .template-box {
            position: relative;
            width: 100%;
            height: 1120px;
            margin: 0 auto;
            background: white;
            border: 2px solid #8B4513;
        }
        
        .template-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .template-background img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        
        .input-box {
            position: absolute;
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 4px;
            padding: 5px;
            font-size: 18px;
            text-align: center;
            font-family: 'Martel', serif;
            outline: none;
            min-width: 120px;
            z-index: 2;
        }
        
        .input-box:focus {
            border-color: #2196F3;
            background: #fff;
        }
        
        .input-box.filled {
            border-color: transparent !important;
            background: transparent !important;
            box-shadow: none !important;
        }
        
        .select-input {
            cursor: pointer;
            background: white;
            z-index: 2;
        }
        
        .select-input.filled {
            background: transparent !important;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        .graha-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(0,0,0,0.4);
            z-index: 1000;
            min-width: 350px;
            max-width: 400px;
        }
        
        .modal-header {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .modal-header h3 {
            color: #8B4513;
            margin-bottom: 5px;
            font-size: 22px;
        }
        
        .house-number-display {
            font-size: 20px;
            font-weight: bold;
            color: #2196F3;
            margin: 10px 0;
        }
        
        .rashi-input-group {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .rashi-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #5d4037;
        }
        
        .rashi-number-input {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            text-align: center;
            border: 2px solid #4CAF50;
            border-radius: 5px;
            font-family: 'Martel', serif;
        }
        
        .rashi-number-input:focus {
            border-color: #2196F3;
            outline: none;
        }
        
        .graha-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px 0;
        }
        
        .graha-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .graha-option:hover {
            background: #f0f0f0;
            border-color: #4CAF50;
        }
        
        .graha-option input {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        
        .graha-option label {
            font-size: 16px;
            cursor: pointer;
            flex: 1;
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .set-btn {
            background: #4CAF50;
            color: white;
        }
        
        .set-btn:hover {
            background: #388E3C;
        }
        
        .cancel-btn {
            background: #f5f5f5;
            color: #333;
            border: 2px solid #ddd;
        }
        
        .cancel-btn:hover {
            background: #e0e0e0;
        }
        
        /* MODIFIED: House box styling - ‡§≠‡§æ‡§µ text is only shown when empty */
        .house-box {
            position: absolute;
            border: 2px dashed #4CAF50;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.3s;
            padding: 5px;
            text-align: center;
            min-height: 60px;
            z-index: 2;
        }
        
        .house-box:hover {
            border: 2px solid #2196F3;
            background: rgba(33, 150, 243, 0.15);
            transform: scale(1.05);
        }
        
        .house-box.filled {
            border: 2px solid transparent;
            background: transparent;
        }
        
        /* MODIFIED: House number - shown only when empty */
        .house-number {
            font-weight: bold;
            color: #8B4513;
            font-size: 12px;
            margin-bottom: 3px;
            display: block; /* Initially shown */
        }
        
        .house-box.filled .house-number {
            display: none !important; /* Hidden when filled */
        }
        
        /* MODIFIED: Rashi display - shown only when filled */
        .rashi-display {
            font-size: 24px; /* Larger for better visibility */
            font-weight: bold;
            color: #8B4513;
            margin-bottom: 3px;
            display: none; /* Initially hidden */
            min-height: 28px;
        }
        
        .house-box.filled .rashi-display {
            display: block !important; /* Shown when filled */
        }
        
        /* MODIFIED: Grahas display - shown only when filled */
        .grahas-display {
            font-size: 14px; /* Slightly larger */
            line-height: 1.4;
            color: #2196F3;
            font-weight: bold;
            display: none; /* Initially hidden */
        }
        
        .house-box.filled .grahas-display {
            display: block !important; /* Shown when filled */
        }
        
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 999;
        }
        
        .instruction-text {
            color: #666;
            font-size: 14px;
            margin: 5px 0 15px 0;
            text-align: center;
        }
        
        .note {
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }
        
        .button-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä ‡§´‡•â‡§∞‡•ç‡§Æ</h1>
        <p>‡§´‡§ï‡•ç‡§§ ‡§¨‡•â‡§ï‡•ç‡§∏ ‡§≠‡§∞‡§æ ‡§Ü‡§£‡§ø PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡§æ</p>
        
        <div class="button-container">
            <button class="download-btn" onclick="downloadPDF()">
                üìÑ PDF Download
            </button>
            <button class="clear-btn" onclick="clearAllData()">
                üóëÔ∏è ‡§∏‡§∞‡•ç‡§µ ‡§°‡•á‡§ü‡§æ ‡§π‡§ü‡§µ‡§æ
            </button>
        </div>
        
        <div class="template-box" id="templateBox">
            <!-- Template Background Image -->
            <div class="template-background">
                <img src="Editable A4 Janma Kundali.png" alt="Kundali Template" id="templateImage" 
                     onerror="this.src='https://via.placeholder.com/800x1120/f0f0f0/8B4513?text=Kundali+Template'">
            </div>
            
            <!-- Input Fields -->
            <input type="text" class="input-box" placeholder="‡§™‡•Ç‡§∞‡•ç‡§£ ‡§®‡§æ‡§µ" 
                   style="left: 25%; top:19.5%; width: 54%; font-size: 18px;">
            
            <input type="text" class="input-box date-input" placeholder="‡§ú‡§®‡•ç‡§Æ ‡§§‡§æ‡§∞‡•Ä‡§ñ" 
                   style="position: absolute; left: 28%; top: 23.5%; width: 150px; font-size: 18px;">

            <select class="input-box select-input" 
                    style="position: absolute; left: 28%; top: 29.5%; width: 150px; font-size: 18px;">
                <option value="">‡§Æ‡§æ‡§∏</option>
                <option value="1">‡§ö‡•à‡§§‡•ç‡§∞</option>
                <option value="2">‡§µ‡•à‡§∂‡§æ‡§ñ</option>
                <option value="3">‡§ú‡•ç‡§Ø‡•á‡§∑‡•ç‡§†</option>
                <option value="4">‡§Ü‡§∑‡§æ‡§¢‡§º</option>
                <option value="5">‡§∂‡•ç‡§∞‡§æ‡§µ‡§£</option>
                <option value="6">‡§≠‡§æ‡§¶‡•ç‡§∞‡§™‡§¶</option>
                <option value="7">‡§Ö‡§∂‡•ç‡§µ‡§ø‡§®</option>
                <option value="8">‡§ï‡§æ‡§∞‡•ç‡§§‡§ø‡§ï</option>
                <option value="9">‡§Æ‡§æ‡§∞‡•ç‡§ó‡§∂‡•Ä‡§∞‡•ç‡§∑</option>
                <option value="10">‡§™‡•å‡§∑</option>
                <option value="11">‡§Æ‡§æ‡§ò</option>
                <option value="12">‡§´‡§æ‡§≤‡•ç‡§ó‡•Å‡§®</option>
            </select>
            
            <select class="input-box select-input" 
                    style="position: absolute; left: 60%; top: 29.5%; width: 75px; font-size: 18px;">
                <option value="">‡§™‡§ï‡•ç‡§∑</option>
                <option value="shukla">‡§∂‡•Å‡§ï‡•ç‡§≤ ‡§™‡§ï‡•ç‡§∑</option>
                <option value="krishna">‡§ï‡•É‡§∑‡•ç‡§£ ‡§™‡§ï‡•ç‡§∑</option>
            </select>

            <select class="input-box select-input" 
                    style="position: absolute; left: 70%; top: 29.5%; width: 75px; font-size: 18px;">
                <option value="">‡§§‡§ø‡§•‡•Ä</option>
                <option value="1">‡§™‡•ç‡§∞‡§§‡§ø‡§™‡§¶‡§æ</option>
                <option value="2">‡§¶‡•ç‡§µ‡§ø‡§§‡•Ä‡§Ø‡§æ</option>
                <option value="3">‡§§‡•É‡§§‡•Ä‡§Ø‡§æ</option>
                <option value="4">‡§ö‡§§‡•Å‡§∞‡•ç‡§•‡•Ä</option>
                <option value="5">‡§™‡§Ç‡§ö‡§Æ‡•Ä</option>
                <option value="6">‡§∑‡§∑‡•ç‡§†‡•Ä</option>
                <option value="7">‡§∏‡§™‡•ç‡§§‡§Æ‡•Ä</option>
                <option value="8">‡§Ö‡§∑‡•ç‡§ü‡§Æ‡•Ä</option>
                <option value="9">‡§®‡§µ‡§Æ‡•Ä</option>
                <option value="10">‡§¶‡§∂‡§Æ‡•Ä</option>
                <option value="11">‡§è‡§ï‡§æ‡§¶‡§∂‡•Ä</option>
                <option value="12">‡§¶‡•ç‡§µ‡§æ‡§¶‡§∂‡•Ä</option>
                <option value="13">‡§§‡•ç‡§∞‡§Ø‡•ã‡§¶‡§∂‡•Ä</option>
                <option value="14">‡§ö‡§§‡•Å‡§∞‡•ç‡§¶‡§∂‡•Ä</option>
                <option value="15">‡§™‡•å‡§∞‡•ç‡§£‡§ø‡§Æ‡§æ</option>
                <option value="16">‡§Ö‡§Æ‡§æ‡§µ‡§∏‡•ç‡§Ø‡§æ</option>
            </select>

            <input type="text" class="input-box" placeholder="‡§ú‡§®‡•ç‡§Æ ‡§µ‡•á‡§≥" 
                   style="left: 28%; top:26.5%; width: 150px; font-size: 18px;">
        
            <select class="input-box select-input" 
                    style="left: 60%; top: 23.5%; width: 150px; font-size: 18px;">
                <option value="">‡§µ‡§æ‡§∞ ‡§®‡§ø‡§µ‡§°‡§æ</option>
                <option value="1">‡§∏‡•ã‡§Æ‡§µ‡§æ‡§∞</option>
                <option value="2">‡§Æ‡§Ç‡§ó‡§≥‡§µ‡§æ‡§∞</option>
                <option value="3">‡§¨‡•Å‡§ß‡§µ‡§æ‡§∞</option>
                <option value="4">‡§ó‡•Å‡§∞‡•Å‡§µ‡§æ‡§∞</option>
                <option value="5">‡§∂‡•Å‡§ï‡•ç‡§∞‡§µ‡§æ‡§∞</option>
                <option value="6">‡§∂‡§®‡§ø‡§µ‡§æ‡§∞</option>
                <option value="7">‡§∞‡§µ‡§ø‡§µ‡§æ‡§∞</option>
            </select>
            
            <select class="input-box select-input" style="left: 60%; top: 26.5%; width: 150px; font-size: 18px;">
                <option value="">‡§™‡•ç‡§∞‡§π‡§∞ ‡§®‡§ø‡§µ‡§°‡§æ</option>            
                <option value="pahat">‡§™‡§π‡§æ‡§ü</option>
                <option value="sakal">‡§∏‡§ï‡§æ‡§≥</option>
                <option value="dupar">‡§¶‡•Å‡§™‡§æ‡§∞</option>
                <option value="sandhyakal">‡§∏‡§Ç‡§ß‡•ç‡§Ø‡§æ‡§ï‡§æ‡§≥</option>
                <option value="ratra">‡§∞‡§æ‡§§‡•ç‡§∞</option>
                <option value="madhyaratra">‡§Æ‡§ß‡•ç‡§Ø‡§∞‡§æ‡§§‡•ç‡§∞</option>
            </select>

<select class="input-box select-input" 
        style="position: absolute; left: 25%; top: 75.4%; width: 150px; font-size: 18px;">
    <option value="">‡§®‡§æ‡§°‡•Ä</option>
    <option value="ady">‡§Ü‡§¶‡•ç‡§Ø ‡§®‡§æ‡§°‡•Ä</option>
    <option value="madhya">‡§Æ‡§ß‡•ç‡§Ø ‡§®‡§æ‡§°‡•Ä</option>
    <option value="antya">‡§Ö‡§Ç‡§§‡•ç‡§Ø ‡§®‡§æ‡§°‡•Ä</option>
</select>

            
            <select class="input-box select-input" 
                    style="position: absolute; left: 65%; top: 75%; width: 150px; font-size: 18px;">
                <option value="">‡§ó‡§£</option>
                <option value="dev">‡§¶‡•á‡§µ ‡§ó‡§£</option>
                <option value="manushya">‡§Æ‡§®‡•Å‡§∑‡•ç‡§Ø ‡§ó‡§£</option>
                <option value="rakshas">‡§∞‡§æ‡§ï‡•ç‡§∑‡§∏ ‡§ó‡§£</option>
            </select>

            <select class="input-box select-input" 
                    style="left: 25%; top: 72.5%; width: 150px; font-size: 18px;">
                <option value="">‡§∞‡§æ‡§∂‡•Ä ‡§®‡§ø‡§µ‡§°‡§æ</option>
                <option>‡§Æ‡•á‡§∑</option>
                <option>‡§µ‡•É‡§∑‡§≠</option>
                <option>‡§Æ‡§ø‡§•‡•Å‡§®</option>
                <option>‡§ï‡§∞‡•ç‡§ï</option>
                <option>‡§∏‡§ø‡§Ç‡§π</option>
                <option>‡§ï‡§®‡•ç‡§Ø‡§æ</option>
                <option>‡§§‡•Ç‡§≥</option>
                <option>‡§µ‡•É‡§∂‡•ç‡§ö‡§ø‡§ï</option>
                <option>‡§ß‡§®‡•Å</option>
                <option>‡§Æ‡§ï‡§∞</option>
                <option>‡§ï‡•Å‡§Ç‡§≠</option>
                <option>‡§Æ‡•Ä‡§®</option>
            </select>
            
            <select class="input-box select-input" 
                    style="left: 25%; top: 67%; width: 150px; font-size: 18px;">
                <option value="">‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞ ‡§®‡§ø‡§µ‡§°‡§æ</option>
                <option value="1">‡§Ö‡§∂‡•ç‡§µ‡§ø‡§®‡•Ä</option>
                <option value="2">‡§≠‡§∞‡§£‡•Ä</option>
                <option value="3">‡§ï‡•É‡§§‡•ç‡§§‡§ø‡§ï‡§æ</option>
                <option value="4">‡§∞‡•ã‡§π‡§ø‡§£‡•Ä</option>
                <option value="5">‡§Æ‡•É‡§ó‡§∂‡•Ä‡§∞‡•ç‡§∑</option>
                <option value="6">‡§Ü‡§∞‡•ç‡§¶‡•ç‡§∞‡§æ</option>
                <option value="7">‡§™‡•Å‡§®‡§∞‡•ç‡§µ‡§∏‡•Å</option>
                <option value="8">‡§™‡•Å‡§∑‡•ç‡§Ø</option>
                <option value="9">‡§Ö‡§∂‡•ç‡§≤‡•á‡§∑‡§æ</option>
                <option value="10">‡§Æ‡§ò‡§æ</option>
                <option value="11">‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ ‡§´‡§æ‡§≤‡•ç‡§ó‡•Å‡§®‡•Ä</option>
                <option value="12">‡§â‡§§‡•ç‡§§‡§∞‡§æ ‡§´‡§æ‡§≤‡•ç‡§ó‡•Å‡§®‡•Ä</option>
                <option value="13">‡§π‡§∏‡•ç‡§§</option>
                <option value="14">‡§ö‡§ø‡§§‡•ç‡§∞‡§æ</option>
                <option value="15">‡§∏‡•ç‡§µ‡§æ‡§§‡§ø</option>
                <option value="16">‡§µ‡§ø‡§∂‡§æ‡§ñ‡§æ</option>
                <option value="17">‡§Ö‡§®‡•Å‡§∞‡§æ‡§ß‡§æ</option>
                <option value="18">‡§ú‡•ç‡§Ø‡•á‡§∑‡•ç‡§†‡§æ</option>
                <option value="19">‡§Æ‡•Ç‡§≤</option>
                <option value="20">‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§∑‡§æ‡§¢‡§º‡§æ</option>
                <option value="21">‡§â‡§§‡•ç‡§§‡§∞‡§æ‡§∑‡§æ‡§¢‡§º‡§æ</option>
                <option value="22">‡§∂‡•ç‡§∞‡§µ‡§£</option>
                <option value="23">‡§ß‡§®‡§ø‡§∑‡•ç‡§†‡§æ</option>
                <option value="24">‡§∂‡§§‡§≠‡§ø‡§∑‡§æ</option>
                <option value="25">‡§™‡•Ç‡§∞‡•ç‡§µ‡§æ‡§≠‡§æ‡§¶‡•ç‡§∞‡§™‡§¶</option>
                <option value="26">‡§â‡§§‡•ç‡§§‡§∞‡§æ‡§≠‡§æ‡§¶‡•ç‡§∞‡§™‡§¶</option>
                <option value="27">‡§∞‡•á‡§µ‡§§‡•Ä</option>
            </select>
            
            <select class="input-box select-input" style="left: 65%; top: 67%; width: 150px; font-size: 18px;">
                <option value="">‡§ö‡§∞‡§£ ‡§®‡§ø‡§µ‡§°‡§æ</option>
                <option value="1">‡•ß</option>
                <option value="2">‡•®</option>
                <option value="3">‡•©</option>
                <option value="4">‡•™</option>
            </select>

            <input type="text" class="input-box" placeholder="‡§ú‡§®‡•ç‡§Æ‡§æ‡§ï‡•ç‡§∑‡§∞" 
                   style="left: 25%; top: 69.7%; width: 150px; font-size: 18px;">

            <input type="text" class="input-box" placeholder="‡§ú‡§®‡•ç‡§Æ ‡§®‡§æ‡§µ" 
                   style="left: 65%; top: 69.5%; width: 150px; font-size: 18px;">
            
            <select class="input-box select-input" 
                    style="left: 65%; top: 72.3%; width: 150px; font-size: 18px;">
                <option value="">‡§∞‡§æ‡§∂‡§ø‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä ‡§®‡§ø‡§µ‡§°‡§æ</option>
                <option>‡§∏‡•Ç‡§∞‡•ç‡§Ø</option>
                <option>‡§ö‡§Ç‡§¶‡•ç‡§∞</option>
                <option>‡§Æ‡§Ç‡§ó‡§≥</option>
                <option>‡§¨‡•Å‡§ß</option>
                <option>‡§ó‡•Å‡§∞‡•Å</option>
                <option>‡§∂‡•Å‡§ï‡•ç‡§∞</option>
                <option>‡§∂‡§®‡§ø</option>
            </select>

            <!-- HOUSE BOXES for Graha Selection -->
            <div class="house-box" data-house="1" style="left: 45%; top: 42%; width: 80px; height: 70px;">
                <div class="house-number">‡§≠‡§æ‡§µ ‡•ß</div>
                <div class="rashi-display"></div>
                <div class="grahas-display"></div>
            </div>
            
            <div class="house-box" data-house="2" style="left: 30%; top: 38%; width: 80px; height: 10px;">
                <div class="house-number">‡§≠‡§æ‡§µ ‡•®</div>
                <div class="rashi-display"></div>
                <div class="grahas-display"></div>
            </div>
            
            <div class="house-box" data-house="3" style="left: 20%; top: 42%; width: 80px; height: 70px;">
                <div class="house-number">‡§≠‡§æ‡§µ ‡•©</div>
                <div class="rashi-display"></div>
                <div class="grahas-display"></div>
            </div>
            
            <div class="house-box" data-house="4" style="left: 30%; top: 47%; width: 80px; height: 70px;">
                <div class="house-number">‡§≠‡§æ‡§µ ‡•™</div>
                <div class="rashi-display"></div>
                <div class="grahas-display"></div>
            </div>
            
            <div class="house-box" data-house="5" style="left: 20%; top: 53%; width: 80px; height: 70px;">
                <div class="house-number">‡§≠‡§æ‡§µ ‡•´</div>
                <div class="rashi-display"></div>
                <div class="grahas-display"></div>
            </div>
            
            <div class="house-box" data-house="6" style="left: 30%; top: 55%; width: 80px; height: 70px;">
                <div class="house-number">‡§≠‡§æ‡§µ ‡•¨</div>
                <div class="rashi-display"></div>
                <div class="grahas-display"></div>
            </div>
            
            <div class="house-box" data-house="7" style="left: 45%; top: 52.5%; width: 80px; height: 70px;">
                <div class="house-number">‡§≠‡§æ‡§µ ‡•≠</div>
                <div class="rashi-display"></div>
                <div class="grahas-display"></div>
            </div>
            
            <div class="house-box" data-house="8" style="left: 60%; top: 55%; width: 80px; height: 70px;">
                <div class="house-number">‡§≠‡§æ‡§µ ‡•Æ</div>
                <div class="rashi-display"></div>
                <div class="grahas-display"></div>
            </div>
            
            <div class="house-box" data-house="9" style="left: 70%; top: 53%; width: 80px; height: 70px;">
                <div class="house-number">‡§≠‡§æ‡§µ ‡•Ø</div>
                <div class="rashi-display"></div>
                <div class="grahas-display"></div>
            </div>
            
            <div class="house-box" data-house="10" style="left: 60%; top: 47%; width: 80px; height: 70px;">
                <div class="house-number">‡§≠‡§æ‡§µ ‡•ß‡•¶</div>
                <div class="rashi-display"></div>
                <div class="grahas-display"></div>
            </div>
            
            <div class="house-box" data-house="11" style="left: 70%; top: 42%; width: 80px; height: 70px;">
                <div class="house-number">‡§≠‡§æ‡§µ ‡•ß‡•ß</div>
                <div class="rashi-display"></div>
                <div class="grahas-display"></div>
            </div>
            
            <div class="house-box" data-house="12" style="left: 60%; top: 38%; width: 80px; height: 70px;">
                <div class="house-number">‡§≠‡§æ‡§µ ‡•ß‡•®</div>
                <div class="rashi-display"></div>
                <div class="grahas-display"></div>
            </div>
            
        </div>

        <!-- Graha Selection Modal -->
        <div class="overlay" id="overlay"></div>
        <div class="graha-modal" id="grahaModal">
            <div class="modal-header">
                <h3>‡§≠‡§æ‡§µ ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó</h3>
                <div class="house-number-display" id="selectedHouse">‡§≠‡§æ‡§µ ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï ‡•ß</div>
                <div class="instruction-text">‡§∞‡§æ‡§∂‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï ‡§Ü‡§£‡§ø ‡§ó‡•ç‡§∞‡§π ‡§®‡§ø‡§µ‡§°‡§æ</div>
            </div>
            
            <div class="rashi-input-group">
                <label for="rashiNumber">‡§∞‡§æ‡§∂‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï (‡•ß ‡§§‡•á ‡•ß‡•®)</label>
                <input type="number" id="rashiNumber" class="rashi-number-input" 
                       min="1" max="12" placeholder="‡§â‡§¶‡§æ: ‡•´">
            </div>
            
            <div style="margin: 20px 0;">
                <div style="font-weight: bold; margin-bottom: 10px; color: #5d4037;">‡§ó‡•ç‡§∞‡§π ‡§®‡§ø‡§µ‡§°‡§æ:</div>
                <div class="graha-options" id="grahaOptions">
                    <!-- Options will be added by JavaScript -->
                </div>
            </div>
            
            <div class="modal-buttons">
                <button class="modal-btn cancel-btn" onclick="closeGrahaModal()">‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡§æ</button>
                <button class="modal-btn set-btn" onclick="setGrahas()">‡§∏‡•á‡§ü ‡§ï‡§∞‡§æ</button>
            </div>
        </div>
        
        <div style="margin-top: 20px; color: #666; font-size: 18px;">
            <p>1. ‡§≠‡§æ‡§µ‡§æ‡§Ç‡§µ‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡§æ ‚Üí 2. ‡§∞‡§æ‡§∂‡•Ä ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï ‡§Ü‡§£‡§ø ‡§ó‡•ç‡§∞‡§π ‡§®‡§ø‡§µ‡§°‡§æ ‚Üí 3. PDF Download ‡§ï‡§∞‡§æ</p>
            <p class="note"><small>PDF ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§´‡§ï‡•ç‡§§ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§¶‡§ø‡§∏‡•á‡§≤ (‡§¨‡•â‡§ï‡•ç‡§∏/‡§¨‡•â‡§∞‡•ç‡§°‡§∞ ‡§®‡§æ‡§π‡•Ä)</small></p>
            <p class="note"><small>Image: Editable_‡§ú‡§®‡•ç‡§Æ_‡§ï‡•Å‡§Ç‡§°‡§≤‡•Ä.png (same folder ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§†‡•á‡§µ‡§æ)</small></p>
        </div>
    </div>

    <script>
        // Graha data
        const allGrahas = [
            "‡§∏‡•Ç", "‡§ö‡§Ç", "‡§Æ‡§Ç", "‡§¨‡•Å", "‡§ó‡•Å", 
            "‡§∂‡•Å", "‡§∂", "‡§∞‡§æ", "‡§ï‡•á"
        ];
        
        // Store data for each house
        const houseData = {};
        let currentHouse = null;
        
        // Initialize house data
        document.querySelectorAll('.house-box').forEach(house => {
            const houseNum = house.dataset.house;
            houseData[houseNum] = {
                rashiNumber: "",
                grahas: []
            };
            
            // Add click event
            house.addEventListener('click', function(e) {
                e.stopPropagation();
                openGrahaModal(houseNum, house);
            });
        });
        
        // Open graha selection modal
        function openGrahaModal(houseNum, houseElement) {
            currentHouse = houseNum;
            
            // Show modal
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('grahaModal').style.display = 'block';
            
            // Update house number display
            document.getElementById('selectedHouse').textContent = `‡§≠‡§æ‡§µ ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï ${houseNum}`;
            
            // Get current data for this house
            const currentData = houseData[houseNum] || { rashiNumber: "", grahas: [] };
            
            // Set rashi number input
            document.getElementById('rashiNumber').value = currentData.rashiNumber;
            
            // Create checkboxes for grahas
            const optionsDiv = document.getElementById('grahaOptions');
            optionsDiv.innerHTML = '';
            
            allGrahas.forEach(graha => {
                const isChecked = currentData.grahas.includes(graha);
                
                const optionDiv = document.createElement('div');
                optionDiv.className = 'graha-option';
                optionDiv.innerHTML = `
                    <input type="checkbox" id="graha_${houseNum}_${graha}" value="${graha}" ${isChecked ? 'checked' : ''}>
                    <label for="graha_${houseNum}_${graha}">${graha}</label>
                `;
                
                optionsDiv.appendChild(optionDiv);
            });
            
            // Focus on rashi input
            setTimeout(() => {
                document.getElementById('rashiNumber').focus();
            }, 100);
        }
        
        // Close modal
        function closeGrahaModal() {
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('grahaModal').style.display = 'none';
            currentHouse = null;
        }
        
        // Set grahas for current house
        function setGrahas() {
            if (!currentHouse) return;
            
            // Get rashi number
            const rashiNumber = document.getElementById('rashiNumber').value;
            
            // Get all checked grahas
            const checkboxes = document.querySelectorAll('#grahaOptions input[type="checkbox"]:checked');
            const selectedGrahas = Array.from(checkboxes).map(cb => cb.value);
            
            // Store data
            houseData[currentHouse] = {
                rashiNumber: rashiNumber,
                grahas: selectedGrahas
            };
            
            // Update house display
            const houseElement = document.querySelector(`.house-box[data-house="${currentHouse}"]`);
            const rashiDisplay = houseElement.querySelector('.rashi-display');
            const grahasDisplay = houseElement.querySelector('.grahas-display');
            
            // Update rashi display
            if (rashiNumber) {
                rashiDisplay.textContent = rashiNumber;
            } else {
                rashiDisplay.textContent = '';
            }
            
            // Update grahas display
            if (selectedGrahas.length > 0) {
                grahasDisplay.textContent = selectedGrahas.join("\n");
            } else {
                grahasDisplay.textContent = '';
            }
            
            // Add or remove filled class
            if (rashiNumber || selectedGrahas.length > 0) {
                houseElement.classList.add('filled');
            } else {
                houseElement.classList.remove('filled');
            }
            
            // Close modal
            closeGrahaModal();
            
            // Save data
            saveDataToLocalStorage();
        }
        
        // Close modal when clicking overlay
        document.getElementById('overlay').addEventListener('click', closeGrahaModal);
        
        // Apply filled class when input has value
        document.querySelectorAll('.input-box').forEach(input => {
            if (input.value) input.classList.add('filled');
            
            input.addEventListener('input', function() {
                if (this.value) {
                    this.classList.add('filled');
                } else {
                    this.classList.remove('filled');
                }
                saveDataToLocalStorage();
            });
            
            input.addEventListener('blur', function() {
                if (this.value) {
                    this.classList.add('filled');
                }
            });
            
            input.addEventListener('focus', function() {
                this.classList.remove('filled');
            });
            
            if (input.tagName === 'SELECT') {
                input.addEventListener('change', function() {
                    if (this.value) {
                        this.classList.add('filled');
                    } else {
                        this.classList.remove('filled');
                    }
                    saveDataToLocalStorage();
                });
            }
        });
        
        // Wait for image to load
        function waitForImageLoad() {
            return new Promise((resolve) => {
                const img = document.getElementById('templateImage');
                if (img.complete && img.naturalWidth !== 0) {
                    resolve();
                } else {
                    img.onload = resolve;
                    img.onerror = resolve;
                }
            });
        }
        
        // Save data to localStorage
        function saveDataToLocalStorage() {
            const formData = {};
            document.querySelectorAll('.input-box').forEach(input => {
                const name = input.placeholder || input.getAttribute('data-name') || `input_${Math.random()}`;
                formData[name] = input.value;
            });
            
            const saveData = {
                houses: houseData,
                form: formData,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('kundaliData', JSON.stringify(saveData));
        }
        
        // Load data from localStorage
        function loadDataFromLocalStorage() {
            const savedData = localStorage.getItem('kundaliData');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    
                    // Load house data
                    if (data.houses) {
                        Object.keys(data.houses).forEach(houseNum => {
                            if (houseData[houseNum]) {
                                houseData[houseNum] = data.houses[houseNum];
                                
                                // Update display
                                const houseElement = document.querySelector(`.house-box[data-house="${houseNum}"]`);
                                if (houseElement) {
                                    const rashiDisplay = houseElement.querySelector('.rashi-display');
                                    const grahasDisplay = houseElement.querySelector('.grahas-display');
                                    const dataForHouse = data.houses[houseNum];
                                    
                                    if (dataForHouse.rashiNumber) {
                                        rashiDisplay.textContent = dataForHouse.rashiNumber;
                                    }
                                    
                                    if (dataForHouse.grahas && dataForHouse.grahas.length > 0) {
                                        grahasDisplay.textContent = dataForHouse.grahas.join("\n");
                                    }
                                    
                                    // Add filled class if data exists
                                    if (dataForHouse.rashiNumber || (dataForHouse.grahas && dataForHouse.grahas.length > 0)) {
                                        houseElement.classList.add('filled');
                                    }
                                }
                            }
                        });
                    }
                    
                    // Load form data
                    if (data.form) {
                        // We'll try to match by placeholder text since we don't have unique names
                        document.querySelectorAll('.input-box').forEach(input => {
                            const placeholder = input.placeholder;
                            if (placeholder && data.form[placeholder]) {
                                input.value = data.form[placeholder];
                                if (input.value) {
                                    input.classList.add('filled');
                                }
                            }
                        });
                    }
                } catch (e) {
                    console.log('Error loading saved data:', e);
                }
            }
        }
        
        // Clear all data
        function clearAllData() {
            if (confirm('‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§≤‡§æ ‡§∏‡§∞‡•ç‡§µ ‡§°‡•á‡§ü‡§æ ‡§π‡§ü‡§µ‡§æ‡§Ø‡§ö‡§æ ‡§Ü‡§π‡•á ‡§ï‡§æ?\n‡§π‡•Ä ‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§™‡•Ç‡§∞‡•ç‡§µ‡§µ‡§§ ‡§ï‡§∞‡§§‡§æ ‡§Ø‡•á‡§£‡§æ‡§∞ ‡§®‡§æ‡§π‡•Ä.')) {
                // Clear inputs
                document.querySelectorAll('.input-box').forEach(input => {
                    input.value = '';
                    input.classList.remove('filled');
                });
                
                // Clear houses
                Object.keys(houseData).forEach(houseNum => {
                    houseData[houseNum] = { rashiNumber: "", grahas: [] };
                    const houseElement = document.querySelector(`.house-box[data-house="${houseNum}"]`);
                    if (houseElement) {
                        houseElement.querySelector('.rashi-display').textContent = '';
                        houseElement.querySelector('.grahas-display').textContent = '';
                        houseElement.classList.remove('filled');
                    }
                });
                
                // Clear localStorage
                localStorage.removeItem('kundaliData');
                alert('‡§∏‡§∞‡•ç‡§µ ‡§°‡•á‡§ü‡§æ ‡§π‡§ü‡§µ‡§≤‡§æ ‡§ó‡•á‡§≤‡§æ');
            }
        }
        
        // PDF download function
async function downloadPDF() {
    const button = document.querySelector('.download-btn');
    const originalText = button.innerHTML;
    button.innerHTML = 'PDF ‡§§‡§Ø‡§æ‡§∞ ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...';
    button.disabled = true;

    try {
        await waitForImageLoad();

        // hide borders
        document.querySelectorAll('.input-box').forEach(el => {
            el.classList.add('filled');
            el.style.padding = '2px';
            if (el.tagName === 'SELECT') el.style.backgroundImage = 'none';
        });
        document.querySelectorAll('.house-box').forEach(el => el.classList.add('filled'));
        button.style.display = 'none';

        const template = document.getElementById('templateBox');

        const canvas = await html2canvas(template, {
            scale: 2,              // IMPORTANT: don't use 3 for print
            useCORS: true,
            backgroundColor: '#ffffff'
        });

        const imgData = canvas.toDataURL('image/png');

        // A4 size in mm
        const A4_WIDTH_MM = 210;
        const A4_HEIGHT_MM = 297;

        // px ‚Üí mm conversion (96 DPI browser ‚Üí 25.4 mm)
        const pxToMm = px => px * 25.4 / 96;

        const imgWidthMm = pxToMm(canvas.width);
        const imgHeightMm = pxToMm(canvas.height);

        const pdf = new jspdf.jsPDF({
            orientation: 'portrait',
            unit: 'mm',
            format: 'a4'
        });

        // SCALE image to EXACT A4
        pdf.addImage(
            imgData,
            'PNG',
            0,
            0,
            A4_WIDTH_MM,
            A4_HEIGHT_MM
        );

        pdf.save('kundali_A4.pdf');

    } catch (e) {
        alert('PDF Error: ' + e.message);
    } finally {
        button.style.display = 'block';
        button.innerHTML = originalText;
        button.disabled = false;

        document.querySelectorAll('.input-box').forEach(el => {
            el.style.padding = '';
            if (el.tagName === 'SELECT') el.style.backgroundImage = '';
        });
    }
}
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved data
            loadDataFromLocalStorage();
            
            // Focus on first input
            const firstInput = document.querySelector('.input-box');
            if (firstInput) {
                firstInput.focus();
            }
            
            // Auto-save data every 5 seconds
            setInterval(saveDataToLocalStorage, 5000);
        });
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+S to save
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveDataToLocalStorage();
                alert('‡§°‡•á‡§ü‡§æ ‡§∏‡•á‡§µ‡•ç‡§π ‡§ï‡•á‡§≤‡§æ ‡§ó‡•á‡§≤‡§æ');
            }
            
            // Ctrl+D to download PDF
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                downloadPDF();
            }
            
            // Escape to close modal
            if (e.key === 'Escape') {
                closeGrahaModal();
            }
        });
    </script>
</body>
</html>
